@page "/"
@using Lomboque.Application.Actions

@inject IHttpClientFactory ClientFactory
@inject DataController DataController


<PageTitle>Index</PageTitle>

<h1>Hello, world!</h1>

Welcome to your new app.



<div>
    json: @json
</div>
<br>
<div>
    dto: @dto
</div>

@code {

    private string? json;
    private string? dto;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if(firstRender)
        {
            dto = DataController.CreateData();

            var request = new HttpRequestMessage(HttpMethod.Get, "http://192.168.2.118/get");
            var client = ClientFactory.CreateClient();
            var response = await client.SendAsync(request);

            if (response.IsSuccessStatusCode)
            {
                using var responseStream = await response.Content.ReadAsStreamAsync();
                using var streamReader = new StreamReader(responseStream);

                json = streamReader.ReadToEnd();
                DataController.SerializeData(json);

                System.Console.WriteLine(json);
                this.StateHasChanged();
            }

            
        }
    }

}